#!/usr/bin/env bash
# --- Script Integrity Check ---
SCRIPT_PATH="scripts/tunnelsats.sh"
HASH_PATH="$SCRIPT_PATH.sha256"

# Check if script is staged
if ! git diff --quiet --cached -- "$SCRIPT_PATH"; then
    echo "ðŸ›¡ï¸  Generating integrity hash for $SCRIPT_PATH..."
    if command -v sha256sum >/dev/null 2>&1; then
        sha256sum -b "$SCRIPT_PATH" > "$HASH_PATH"
    elif command -v shasum >/dev/null 2>&1; then
        # Fallback for macOS/BSD. Format output to match `sha256sum -b`.
        hash=$(shasum -a 256 "$SCRIPT_PATH" | cut -d ' ' -f 1)
        echo "$hash *$SCRIPT_PATH" > "$HASH_PATH"
    else
        echo "âš ï¸  Error: 'sha256sum' or 'shasum' command not found." >&2
        echo "Cannot generate integrity hash. Please install one of these tools." >&2
        exit 1
    fi
    git add "$HASH_PATH"
    echo "âœ… Updated $HASH_PATH"
fi
